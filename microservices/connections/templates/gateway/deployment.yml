apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: gateway
spec:
  replicas: 3
  strategy:
    rollingUpdate:
      maxUnavailable: 1
      maxSurge: 2
  template:
    metadata:
      labels:
        service: gateway
    spec:
      containers:
      - env:
        - name: ORIENT_CNX_INTERSERVICE_PORT
          valueFrom:
            configMapKeyRef:
              name: connections-env
              key: orient-cnx-interservice-port
        - name: ORIENT_CNX_INTERSERVICE_SCHEME
          valueFrom:
            configMapKeyRef:
              name: connections-env
              key: orient-cnx-interservice-scheme
        - name: ORIENT_CNX_INTERSERVICE_HOST
          valueFrom:
            configMapKeyRef:
              name: connections-env
              key: orient-cnx-interservice-host        
        - name: ORIENT_CNX_PORT
          valueFrom:
            configMapKeyRef:
              name: connections-env
              key: orient-cnx-port
        - name: ORIENT_CNX_SCHEME
          valueFrom:
            configMapKeyRef:
              name: connections-env
              key: orient-cnx-host
        - name: PORT
          value: "8001"
        - name: NODE_DEBUG
          value: "0"
        - name: ORIENT_CNX_HOST
          valueFrom:
            configMapKeyRef:
              name: connections-env
              key: orient-cnx-host
        image: 905409959051.dkr.ecr.us-east-1.amazonaws.com/connections-docker/orient-gateway-service
        name: gatewaycontainer
        ports:
        - containerPort: 8001
          protocol: TCP
      restartPolicy: Always
